import{S as m,T as I}from"./telegram-6fcb429f.js";const T="modulepreload",p=function(e){return"/"+e},f={},y=function(t,n,a){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=p(r),r in f)return;f[r]=!0;const s=r.endsWith(".css"),d=s?'[rel="stylesheet"]':"";if(!!a)for(let u=o.length-1;u>=0;u--){const l=o[u];if(l.href===r&&(!s||l.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${d}`))return;const c=document.createElement("link");if(c.rel=s?"stylesheet":T,s||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),s)return new Promise((u,l)=>{c.addEventListener("load",u),c.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t()).catch(r=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r})},g={async init(){chrome.contextMenus.removeAll(async()=>{chrome.contextMenus.create({id:"swiftshift-root",title:"SwiftShift: Send to Telegram",contexts:["selection","link","image","video","page"]});const e=await m.getActiveProfile();if(!e||!e.botToken){this.createSetupPlaceholder();return}const{recentTargets:t}=await chrome.storage.local.get("recentTargets");if(t&&t.length>0){const n=t.slice(0,3);for(const a of n){const o=e.targets.find(r=>r.id===a);o&&chrome.contextMenus.create({id:`target-${o.id}`,parentId:"swiftshift-root",title:`ðŸ“¤ ${o.name}`,contexts:["all"]})}chrome.contextMenus.create({id:"separator-1",parentId:"swiftshift-root",type:"separator",contexts:["all"]})}e.targets.length>0?(chrome.contextMenus.create({id:"more-targets",parentId:"swiftshift-root",title:"More...",contexts:["all"]}),e.targets.forEach(n=>{chrome.contextMenus.create({id:`more-${n.id}`,parentId:"more-targets",title:n.name,contexts:["all"]})})):chrome.contextMenus.create({id:"no-targets",parentId:"swiftshift-root",title:"âš ï¸ No Channels Found",enabled:!1,contexts:["all"]})})},createSetupPlaceholder(){chrome.contextMenus.create({id:"setup-required",parentId:"swiftshift-root",title:"âš ï¸ Setup Required (Click Extension Icon)",enabled:!1,contexts:["all"]})},async onClicked(e,t){if(!e.menuItemId.toString().startsWith("target-")&&!e.menuItemId.toString().startsWith("more-"))return;const a=e.menuItemId.toString().replace("target-","").replace("more-",""),o=await this.buildPayload(e,t);if(!o)return;const r=await m.getActiveProfile();if(!r)return;const s=r.targets.find(c=>c.id===a),d={chatId:a,threadId:s==null?void 0:s.threadId,...o},i=await I.sendPayloadSmart(r.botToken,d);t!=null&&t.id&&chrome.tabs.sendMessage(t.id,{type:"TOAST_NOTIFICATION",status:i.success?"success":"error",message:i.success?"Sent successfully":i.error}).catch(()=>{console.log("Could not send toast to tab")}),await m.addRecentTarget(a),this.init()},async buildPayload(e,t){return e.selectionText?{text:e.selectionText}:e.linkUrl?{text:e.linkUrl}:e.mediaType==="image"&&e.srcUrl?{photo:e.srcUrl,caption:t==null?void 0:t.url}:e.mediaType==="video"&&e.srcUrl?{text:`Video: ${e.srcUrl} 
Source: ${t==null?void 0:t.url}`}:t!=null&&t.url?{text:`${t.title||"Page"}
${t.url}`}:null}};console.log("SwiftShift Background Worker Starting...");chrome.runtime.onInstalled.addListener(async()=>{console.log("Extension Installed/Updated"),await m.init(),await g.init()});chrome.runtime.onStartup.addListener(async()=>{await g.init()});chrome.contextMenus.onClicked.addListener((e,t)=>{g.onClicked(e,t)});chrome.runtime.onMessage.addListener((e,t,n)=>{if(e.type==="REFRESH_MENU")return g.init().then(()=>{n({success:!0})}),!0});chrome.commands.onCommand.addListener(async e=>{var t;if(e==="quick_send"){const[n]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(n!=null&&n.id))return;const a=n.id;try{const o=await chrome.tabs.sendMessage(a,{type:"CAPTURE_CONTENT"});if(!o||!o.text)return;const r=await m.getActiveProfile();if(!r){chrome.tabs.sendMessage(a,{type:"TOAST_NOTIFICATION",status:"error",message:"Setup required",subtext:"Click extension icon to connect."});return}const{recentTargets:s}=await chrome.storage.local.get("recentTargets"),d=s&&s.length>0?s[0]:(t=r.targets[0])==null?void 0:t.id;if(!d){chrome.tabs.sendMessage(a,{type:"TOAST_NOTIFICATION",status:"error",message:"No channels found",subtext:"Please add the bot to a channel."});return}const i=r.targets.find(l=>l.id===d),c=i?`Sent to ${i.name}`:"Sent to Telegram";chrome.tabs.sendMessage(a,{type:"TOAST_NOTIFICATION",status:"info",message:"Sending...",subtext:c});const u={chatId:d,threadId:i==null?void 0:i.threadId,text:o.text};y(()=>import("./telegram-6fcb429f.js").then(l=>l.t),[]).then(async({TelegramService:l})=>{const h=await l.sendPayloadSmart(r.botToken,u);chrome.tabs.sendMessage(a,{type:"TOAST_NOTIFICATION",status:h.success?"success":"error",message:h.success?"Sent successfully":"Failed to send",subtext:h.success?void 0:h.error})})}catch(o){console.error(o)}}});
